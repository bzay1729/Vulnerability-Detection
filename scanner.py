# src/scanner.py

import nmap


def check_vulnerability(port, service):
    vulnerabilities = {
        21: "Potentially vulnerable FTP service (Port 21)",
        22: "Potential SSH misconfiguration (Port 22)",
        80: "Check for outdated HTTP services (Port 80)",
        443: "Check for outdated HTTPS services (Port 443)"
    }

    if port in vulnerabilities:
        return vulnerabilities[port]
    return f"No known vulnerabilities for {service} on Port {port}"


def scan_network(target_ip):
    nm = nmap.PortScanner()
    nm.scan(target_ip, '1-1024')
    for host in nm.all_hosts():
        print(f'Host: {host} ({nm[host].hostname()})')
        print(f'State: {nm[host].state()}')
        for protocol in nm[host].all_protocols():
            print(f'Protocol: {protocol}')
            ports = nm[host][protocol].keys()
            for port in ports:
                service = nm[host][protocol][port]['name']
                state = nm[host][protocol][port]["state"]
                print(f'Port: {port}, State: {state}, Service: {service}')

                # Check for vulnerabilities
                vulnerability = check_vulnerability(port, service)
                print(f"Vulnerability Check: {vulnerability}")


if __name__ == '__main__':
    target = input("Enter the target IP: ")
    scan_network(target)
